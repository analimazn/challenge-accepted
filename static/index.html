<!DOCTYPE HTML>
<!--
	Highlights by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Climatempo - O melhor site de meteorologia do Brasil</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="css/main.css" />
		<script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
	</head>
	<body class="is-preload">

		<!-- Header -->
			<section id="header">
				<header class="major">
					<a href="https://www.climatempo.com.br"><h1>Climatempo</h1></a>
				</header>
			</section>

		<!-- Search Locales -->
			<section class="main special">
				<div id="weather" class="container">
					<div class="content">
						<form v-on:submit.prevent>
							<input type="text" placeholder="Digite uma cidade..." v-model="name">
							<input type="submit" value="Buscar" v-on:click="getInputSearch"/>
						</form>
						{{ message }}
					</div>
					<div class="card" v-for="weather in weathers">
						<h1> Previsão para {{ weather.locale.name }} - {{weather.locale.state}} </h1>
						<ul class="actions special">
							<li>
								<div class="card"  v-for="forecasts in weather.weather">
									<h3> {{ reverseDate(forecasts.date) }} </h3>	
									<span> {{ forecasts.text }} </span>
									<table>
										<tr>
											<th> {{ forecasts.temperature.min }} ºC  </th> 
											<th><img src="images/icons/cold.png" height=40 width=40></th>
											<th> {{ forecasts.temperature.max }} ºC </th>
											<th> <img src="images/icons/hot.png" height=40 width=40"/> </th>	
										</tr>
										<tr>
											<th> {{ forecasts.rain.precipitation }} mm </th>
											<th><img src="images/icons/raindrop.png" height=40 width=40></th>
											<th> {{ forecasts.rain.probability }} % </th>
											<th><img src="images/icons/umbrella.png" height=40 width=40></th>
										</tr>
									</table>
					
								</div>
							</li>
						</ul>
					</div>
				</div>
			</section>

		<!-- Footer -->
			<section id="footer">
				<footer>
					<ul class="copyright">
						<li><a href="https://www.linkedin.com/in/analimazn/">by: analima</a></li>
					</ul>
				</footer>
			</section>
			<script>
				const weather = new Vue({
					el: "#weather",
					data: {
						id: "",
						name: "",
						message: "",
						status: "",
						weathers: []
					},
					methods: {
						getInputSearch: async function() {
			                await axios
								.get( "http://localhost:5000/locales/" + this.name)
								.then(res => {
									if(res.status == 200 && res.data.length) {
										this.message = "";
										this.id = res.data[0].id;
									} else {
										this.message = "Cidade não localizada."
									}
								})
								.catch(err => {
									console.log(err);
									this.message = "Insira um valor válido."
								});
							this.name = "";

							if (this.id) {
								await axios
									.get( "http://localhost:5000/weather-forecasts/" + this.id)
									.then(res => {
										this.status = "Sucesso"
										this.weathers = res.data;
									})
									.catch(err => console.log(err));
							} else {
								this.status = "Sem previsões hoje"
							}
						},
						reverseDate: function (date) {
					     	let newDate = date.split('-').reverse()
					     	return (newDate[0] + '/' + newDate[1] + '/' + newDate[2])
					    }
					}
				});
		</script>
	</body>
</html>